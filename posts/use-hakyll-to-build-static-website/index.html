<!doctype html>
<html lang="zh-cmn-Hans" class="han-init">
  <head>
    <meta charset="utf-8">
    <title>编程青年 - 使用 hakyll 构建静态站点</title>
    <meta name="description" content="编程青年的博客，记录着软件开发中的点点滴滴">
    <meta name="copyright" content="Ma Lucheng 2014-2015">
    <meta name="generator" content="pandoc">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">

    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">

    <link href="/css/app.css" rel="stylesheet">
    <link href="//cdn.bootcss.com/highlight.js/8.9.1/styles/solarized_light.min.css" rel="stylesheet">
  </head>

  <body class="container">
    <header class="global-header row">
      <h1 class="global-header__logo four columns"><a href="/" class="blog-title-link">编程青年</a></h1>
      <nav id="menu1" class="navbar eight columns">
        <ul class="navbar-list">
          
            <li class="navbar-item">
              <a href="/posts/" class="navbar-link" target='_self'>posts</a>
            </li>
          
            <li class="navbar-item">
              <a href="/essays/" class="navbar-link" target='_self'>essays</a>
            </li>
          
            <li class="navbar-item">
              <a href="/reading/" class="navbar-link" target='_self'>reading</a>
            </li>
          
            <li class="navbar-item">
              <a href="http://songofcode.com/how-to-learn-emacs-chinese-edition/" class="navbar-link" target='_blank'>emacs</a>
            </li>
          
            <li class="navbar-item">
              <a href="/about/" class="navbar-link" target='_self'>about</a>
            </li>
          
            <li class="navbar-item">
              <a href="https://github.com/teddy-ma/" class="navbar-link" target='_blank'>github</a>
            </li>
          
        </ul>
      </nav>
      <nav id="menu2" class="path-nav path-nav-top-right">
        <a href="#menu2" class="path-nav-expander">
          <div class="ball"></div>
        </a>
        <a href="#" class="path-nav-close"></a>
        <ul>
          
            <li>
              <a href="/posts/" target='_self'>posts</a>
            </li>
          
            <li>
              <a href="/essays/" target='_self'>essays</a>
            </li>
          
            <li>
              <a href="/reading/" target='_self'>reading</a>
            </li>
          
            <li>
              <a href="http://songofcode.com/how-to-learn-emacs-chinese-edition/" target='_blank'>emacs</a>
            </li>
          
            <li>
              <a href="/about/" target='_self'>about</a>
            </li>
          
            <li>
              <a href="https://github.com/teddy-ma/" target='_blank'>github</a>
            </li>
          
        </ul>
      </nav>
    </header>

    <main id="baseline" role="main" class="page-main typo yue row">
      <div class="section typeset twelve columns">
        <!-- 文章视图 -->
<article>
  <h1 id="使用-hakyll-构建静态站点">使用 hakyll 构建静态站点</h1>
<h2 id="什么是-hakyll">什么是 hakyll</h2>
<p>hakyll 是类似于 jekyll 的一个用来搭建静态站点的工具</p>
<h2 id="hakyll-与-jekyll-的不同">hakyll 与 jekyll 的不同</h2>
<p>hakyll 与其他大多数同类工具相比 拥有非常大的灵活性, jekyll 是一个遵循约定大于配置的工具, 使用 jekyll 就必须遵循它的约定, 比如博文需要以 yy-mm-dd 开头的文件名形式存放在 <sub>posts</sub>/ 文件夹下. 而 hakyll 就拥有更大的灵活性, hakyll 的哲学在于, 用户书写内容, hakyll 负责把这些 内容转化成不同的展现形式. 这样生成的站点形式就不局限于博客, 也可以包含 slides 或者 pdf 之类的内容.</p>
<h2 id="hakyll-的安装与基本使用">hakyll 的安装与基本使用</h2>
<p>hakyll 使用非常高大上的 haskell 语言编写, 所以要使用 hakyll 就需要 haskell 环境. 在 mac 下的安装非常简单</p>
<pre class="shell-script"><code>  brew install ghc cabal-install
</code></pre>
<p>安装完成后记得把 $HOME/.cabal/bin 加入到 $PATH. 然后就可以新建一个站点了</p>
<pre class="shell-script"><code>  $ hakyll-init my-site
  $ cd my-site
  $ ghc --make -threaded site.hs
  $ ./site build
  $ ./site watch
</code></pre>
<p>打开 <a href="http://localhost:8000/" class="uri">http://localhost:8000/</a> 就能看到默认生成的站点了, 如果你只想像使用 jekyll 一样使用 hakyll 的话, 到这里就够了, 同样在 posts 文件夹下书写你的博文就可以了</p>
<h2 id="hakyll-的高级功能">hakyll 的高级功能</h2>
<p>如果你想领略 hakyll 的强大而灵活的配置, 那么请往下看</p>
<h3 id="hakyll-的工作原理">hakyll 的工作原理</h3>
<p>如果你照着上面的方式安装并初始化了 hakyll 的话, 你的站点文件结构就会类似于</p>
<pre class="shell-script"><code>  .
  ├── README.md
  ├── about.rst
  ├── contact.markdown
  ├── css
  │   └── default.scss
  ├── images
  │   └── haskell-logo.png
  ├── index.html
  ├── posts
  │   └── use-hakyll-to-build-static-website.org
  ├── site
  ├── site.hi
  ├── site.hs
  ├── site.o
  └── templates
      ├── archive.html
      ├── default.html
      ├── post-list.html
      └── post.html
</code></pre>
<p>这样, 其实除了 site 开头的几个文件以外 (site 是编译好的二进制文件, 有100mb 左右大小, 记得不要纳入版本控制!), 其他都是静态文件, 且结构是可以随便定义的。其中 site.hs 可以认为是 hakyll 的配置文件, 打开它就会看到一大堆看（高）不（大）懂（上）的 haskell 代码。</p>
<p>稍微观察一下就会发现, 其中有三个关键词</p>
<ul>
<li>match</li>
<li>route</li>
<li>compile</li>
</ul>
<p>match 就是匹配, 后面的文件名是你站点目录下的源文件, 比如 'css/*' 就指代 css 文件夹下的所有文件</p>
<p>route 和我们通常程序中所有的路由有点不同, 指的是 match 到的文件会被放置在编译好的站点的位置（默认是 <sub>site</sub> 文件夹）</p>
<p>compile 就像是一个管道, 一个资源, 从 match (头) 到 route(尾) 的过程中需要做的转换工作, 比如 markdown -&gt; html， 或者压缩混淆等</p>
<p>这样一来 hakyll 的结构就很清楚了, 用户提供原始的数据, 然后 hakyll 就去编译他们并且放置到正确的位置</p>
<p>下面举几个实际的例子, 来表现一下 hakyll 的强大</p>
<h3 id="sass-支持">sass 支持</h3>
<pre class="haskell"><code>  -- 使用 compass 来处理 scss 样式
  match (fromList [&quot;sass/main.scss&quot;, &quot;sass/blog.scss&quot;]) $ do
      route   $ setExtension &quot;css&quot;
      compile $ getResourceString &gt;&gt;=
          withItemBody (unixFilter &quot;sass&quot; [&quot;-s&quot;, &quot;--scss&quot;, &quot;-I&quot;, &quot;sass/&quot;]) &gt;&gt;=
          return . fmap compressCss
</code></pre>
<h3 id="创建不存在的页面">创建不存在的页面</h3>
<pre class="haskell"><code>  create [&quot;archive.html&quot;] $ do
      route idRoute
      compile $ do
          posts &lt;- recentFirst =&lt;&lt; loadAll &quot;posts/*&quot;
          let archiveCtx =
                  listField &quot;posts&quot; postCtx (return posts) `mappend`
                  constField &quot;title&quot; &quot;Archives&quot;            `mappend`
                  defaultContext
          makeItem &quot;&quot;
              &gt;&gt;= loadAndApplyTemplate &quot;templates/archive.html&quot; archiveCtx
              &gt;&gt;= loadAndApplyTemplate &quot;templates/default.html&quot; archiveCtx
              &gt;&gt;= relativizeUrls
</code></pre>
<p>这个例子中 archive.html 这个页面原本是不存在的, 里面的内容都是动态获取的, 它读取了 posts/ 下的所有文件 读取他们的 title 属性, 然后列出来, 这和 jekyll 的读取一个对象的属性并循环出来有点不同, 毕竟 haskell 是函数式语言</p>
<h3 id="幻灯片">幻灯片</h3>
<pre class="haskell"><code>  match &quot;slides/*&quot; $ do
      route   $ setExtension &quot;html&quot;
      compile $ getResourceString &gt;&gt;=
          withItemBody (unixFilter &quot;pandoc&quot; [&quot;-s&quot;, &quot;--mathml&quot;, &quot;-i&quot;, &quot;-t&quot;, &quot;dzslides&quot;])
</code></pre>
<p>使用强大的 pandoc, 直接就把 markdown 文件变成 slides 了.</p>
<h3 id="真实的例子">真实的例子</h3>
<p><a href="http://jaspervdj.be/hakyll/examples.html">这里</a> 列出了很多使用 hakyll 的网站, 都有源码在 github 上, 可供参考</p>
<h2 id="总结">总结</h2>
<p>hakyll 就是一根管道, 把你书写的内容以合适的方式展现出来便是它的作用了</p>

</article>

      </div>
    </main> <!-- 网页主体 -->

    <!-- 评论框 -->

    <footer role="contentinfo" class="global-footer row">
      <p class="copyright">© Ma Lucheng 2014-2015 — All content is licensed under the
        <a href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons BY-SA 3.0</a>.
      </p>

      <figure class="footer-zfm">
        <img src="http://javaer.qiniudn.com/zhifuma.png" alt="支付宝二维码" />
        <figcaption>觉得文章对你有帮助，可以打赏一杯咖啡支持一下</figcaption>
      </figure>
    </footer><!-- 页脚 -->

    <script src="/js/vendor.js"></script>
    <script src="/js/app.js"></script>
    <script src="//cdn.bootcss.com/highlight.js/8.9.1/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <script>require('main').init();</script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-68587267-1', 'auto');
      ga('send', 'pageview');
    </script>

    <script src="//cdn.bootcss.com/instantclick/3.0.1/instantclick.min.js"></script>
    <script>
      InstantClick.on('change', function() {
        var blocks = document.querySelectorAll('pre code');
        for (var i = 0; i < blocks.length; i++) {
          hljs.highlightBlock(blocks[i]);
        }
      });
    </script>

    <script type="text/javascript" src=""></script>
  </body>
</html>
