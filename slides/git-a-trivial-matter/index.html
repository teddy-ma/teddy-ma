<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>reveal.js - The HTML Presentation Framework</title>
    <meta name="description" content="A framework for easily creating beautiful presentations using HTML">
    <meta name="author" content="Hakim El Hattab">
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

    <link rel="stylesheet" href="../reveal/css/reveal.css">
    <link rel="stylesheet" href="../reveal/css/theme/black.css" id="theme">
    <!-- Code syntax highlighting -->
    <link rel="stylesheet" href="../reveal/lib/css/zenburn.css">

    <!-- Printing and PDF exports -->
    <script>
      var link = document.createElement( 'link' );
      link.rel = 'stylesheet';
      link.type = 'text/css';
      link.href = window.location.search.match( /print-pdf/gi ) ? '../reveal/css/print/pdf.css' : '../reveal/css/print/paper.css';
      document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>

    <!--[if lt IE 9]>
	<script src="../reveal/lib/js/html5shiv.js"></script>
	<![endif]-->
  </head>

  <body>

    <div class="reveal">

      <!-- Any section element inside of this container is displayed as a slide -->
      <div class="slides" id="main-container">
	      <h1 id="git-这件小事">Git 这件小事</h1>
<p>author: 马陆骋&lt;malucheng@boohee.com&gt;</p>
<h2 id="目录">目录</h2>
<ul>
<li>git 初始化配置</li>
<li>git 分支操作</li>
<li>git 高级技巧</li>
<li>git 时空穿越</li>
<li>git 差异对比</li>
<li>git 解决冲突</li>
<li>git 黑暗料理</li>
<li>git 好的提交</li>
<li>git 拾遗</li>
</ul>
<h2 id="初始化配置">初始化配置</h2>
<pre><code>cat ~/.gitconfig

[user]
  name = 马陆骋
  email = malucheng@boohee.com
[push]
  default = simple
[core]
  excludesfile = /Users/teddy/.gitignore_global
[commit]
  template = ~/.gitmessage
</code></pre>
<h2 id="分支操作">分支操作</h2>
<p>轻量级的分支是 git 的杀手特性</p>
<h3 id="基本分支操作">基本分支操作</h3>
<pre><code>git branch -vr # 查看远程分支
git checkout -b feature/my_branch # 创建并切换到新分支
git push origin feature/my_branch # 将本地分支提交到远程（code review）
git checkout -t origin/feature/login # 自动切换并跟踪远程分支
git push origin :no_need_more # 删除远程分支
git remote prune origin # 清除本地残留的无用分支
</code></pre>
<h3 id="分支的合并">分支的合并</h3>
<p>假设 dev 分支是从 master 分支 checkout 出来的，那么合并的方式有：</p>
<ul>
<li>直接合并</li>
<li>rebase 合并</li>
<li>sqush 合并</li>
</ul>
<h3 id="直接合并">直接合并</h3>
<pre><code>git checkout master
git merge dev
</code></pre>
<p>产生一次 merge 的 commit</p>
<p>便于查看特性的提交和审查</p>
<p>就是 gitlab 的 pr 形式</p>
<h3 id="rebase-合并">rebase 合并</h3>
<pre><code>git checkout dev
git rebase master
</code></pre>
<p>变基: master 成为了 dev 分支的&quot;基(foundation)&quot;</p>
<p>这样不会创建一次 merge 提交</p>
<p>提交记录更加干净整洁, 但同时也失去了 merge 的记录</p>
<p>不适合需要 code review 的情况</p>
<h3 id="sqush-合并">sqush 合并</h3>
<pre><code>git checkout master
git merge dev --squash
</code></pre>
<p>虽然命令是 merge, 但实际不会产生提交, 执行命令的结果是</p>
<p>所有 dev 分支和 master 不同的部分都将以 modified 的形式出现, 需要再次手动 commit</p>
<p>适用场景是实验性质的分支在实验成功后, 由于有很多探索型的提交, 用 --squash 可以一次性消灭掉</p>
<p>另外这样做的话需要手动强制删除 dev 分支 <code>git branch -D dev</code></p>
<h2 id="高级技巧">高级技巧</h2>
<h3 id="暂存">暂存</h3>
<p>使用场景：当你开发一个新特性时，突然有一个临时的小需求，比如修改提示文案。</p>
<pre><code>git add .
git stash
git checkout master
git commit -am &quot;update notify message&quot;
git push
git checkout feature
git stash pop
</code></pre>
<h3 id="提取某次提交">提取某次提交</h3>
<p>使用场景：在分支上开发时，如果分支短时间内不会合并 而主干又需要分支上的一些特性时。使用:</p>
<pre><code>git cherry pick
</code></pre>
<h3 id="子模块">子模块</h3>
<p>使用场景：rails 引擎，内嵌 gem 等</p>
<pre><code>git submodule add https://github.com/zsh-users/antigen.git common/.antigen
git submodule init
git submodule update
</code></pre>
<h2 id="时空穿越">时空穿越</h2>
<ul>
<li>在 git 的世界中，逆转时空根本不是事</li>
</ul>
<h3 id="回到上一次提交的状态">回到上一次提交的状态</h3>
<pre><code>git reset HEAD~ --hard # 本次提交的内容不复存在
git reset HEAD~ --soft # 本次提交的内容进入未提交状态
</code></pre>
<h3 id="修补上一次没写好的提交">修补上一次没写好的提交</h3>
<pre><code>git add .
git commit --amend
git push -f # 如果之前 push 过的话
</code></pre>
<h2 id="差异对比">差异对比</h2>
<h3 id="同一分支对比">同一分支对比</h3>
<p>git diff master~ master -- path/to/file</p>
<h3 id="同一文件不同分支对比">同一文件不同分支对比</h3>
<p>git diff master dev -- path/to/file</p>
<h3 id="常用参数">常用参数</h3>
<ul>
<li>--word-diff</li>
<li>--stat</li>
</ul>
<h2 id="处理冲突">处理冲突</h2>
<h3 id="一个常见情境">一个常见情境</h3>
<pre><code>git push
To git@git.boohee.cn:ruby/bingo.git
 ! [rejected]        master -&gt; master (fetch first)
error: failed to push some refs to &#39;git@git.boohee.cn:ruby/bingo.git&#39;
hint: Updates were rejected because the remote contains work that you do
hint: not have locally. This is usually caused by another repository pushing
hint: to the same ref. You may want to first integrate the remote changes
hint: (e.g., &#39;git pull ...&#39;) before pushing again.
hint: See the &#39;Note about fast-forwards&#39; in &#39;git push --help&#39; for details.
</code></pre>
<h3 id="可选的解决方案">可选的解决方案</h3>
<pre><code>git pull --rebase
remote: Counting objects: 54, done.
remote: Compressing objects: 100% (14/14), done.
remote: Total 14 (delta 11), reused 0 (delta 0)
Unpacking objects: 100% (14/14), done.
From git.boohee.cn:ruby/bingo
   4bf29b0..564947f  master     -&gt; origin/master
First, rewinding head to replay your work on top of it...
Applying: add knowledge routes format
</code></pre>
<h3 id="the-bad-ending">the bad ending</h3>
<pre><code>git status
rebase in progress; onto 1fa9bbf
You are currently rebasing branch &#39;master&#39; on &#39;1fa9bbf&#39;.
  (fix conflicts and then run &quot;git rebase --continue&quot;)
  (use &quot;git rebase --skip&quot; to skip this patch)
  (use &quot;git rebase --abort&quot; to check out the original branch)

Changes to be committed:
  (use &quot;git reset HEAD &lt;file&gt;...&quot; to unstage)

    modified:   app/controllers/admin/base_controller.rb
    modified:   app/controllers/admin/consultors_controller.rb
    new file:   app/views/admin/consultors/update.js.erb
    modified:   app/views/admin/conversations/index.html.erb

Unmerged paths:
  (use &quot;git reset HEAD &lt;file&gt;...&quot; to unstage)
  (use &quot;git add &lt;file&gt;...&quot; to mark resolution)

    both modified:   app/controllers/api/v1/home_controller.rb
</code></pre>
<h3 id="the-best-solution">the best solution</h3>
<pre><code>git rebase --abort
</code></pre>
<h2 id="黑暗料理">黑暗料理</h2>
<h3 id="喷子必备">喷子必备</h3>
<pre><code>git blame /path/to/file
</code></pre>
<h3 id="天朝网络必备">天朝网络必备</h3>
<p>☁ /tmp git clone git@github.com:apiaryio/api-blueprint.git Cloning into 'api-blueprint'... remote: Counting objects: 1497, done. <sup>CKilled</sup> by signal 2.4% (659/1497), 1.20 MiB | 29.00 KiB/s fatal: The remote end hung up unexpectedly</p>
<p>☁ /tmp git clone --depth=1 git@github.com:apiaryio/api-blueprint.git Cloning into 'api-blueprint'... remote: Counting objects: 32, done. remote: Compressing objects: 100% (31/31), done.</p>
<h2 id="好的提交记录">好的提交记录</h2>
<p>任何人都可以从提交记录看到你 <strong>做了什么</strong> 但是代码不能说明 <strong>为什么</strong> 要这么做</p>
<h3 id="what">what</h3>
<pre class="example"><code>添加方案修改页面
</code></pre>
<h3 id="why">why</h3>
<pre class="example"><code>顾问可以在后台修改用户的方案
</code></pre>
<ul>
<li>提供了完成工作的上下文</li>
</ul>
<h3 id="use-template">use template</h3>
<pre><code>[commit]
  template = ~/.gitmessage

Why:

*

This change addresses the need by:

*

# 50-character subject line
#
# 72-character wrapped longer description.
</code></pre>
<h3 id="tips">tips</h3>
<ul>
<li><p>不要使用 `-m` 参数</p></li>
<li><p>第一行总结不要超过50个字</p></li>
<li><p>空一行后进行更详细的论述</p></li>
</ul>
<h2 id="misc">misc</h2>
<h3 id="好习惯">好习惯</h3>
<ul>
<li><p>使用最新版的 git</p></li>
<li><p>开工前先 pull 一下 <code>git pull</code></p></li>
<li><p>小步提交, 事后合并</p></li>
<li><p>切出只属于自己的分支, 就能放心的使用 <code>-f</code> 参数</p></li>
</ul>
<h3 id="代码风格">代码风格</h3>
<p><a href="https://github.com/aseaday/git-style-guide" class="uri">https://github.com/aseaday/git-style-guide</a></p>
<h2 id="worktree">worktree</h2>
<p>分别管理 github-pages 和工作分支</p>
<pre><code>git worktree add -b gh-pages ../project-gh-pages origin/gh-pages
</code></pre>
<h2 id="thanks">Thanks</h2>
<p>Question?</p>

      </div>

    </div>

    <!-- hook html struct -->
    <script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
    <script src="../reveal/org-adapter.js"></script>
    <script>
      // for #main-container
      revealjs_adapter();
    </script>

    <script src="../reveal/lib/js/head.min.js"></script>
    <script src="../reveal/js/reveal.js"></script>

    <script>

      // Full list of configuration options available at:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        controls: true,
        progress: true,
        history: true,
        center: true,

        transition: 'slide', // none/fade/slide/convex/concave/zoom

        // Optional reveal.js plugins
        dependencies: [
          { src: '../reveal/lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: '../reveal/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: '../reveal/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: '../reveal/plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
          { src: '../reveal/plugin/zoom-js/zoom.js', async: true },
          { src: '../reveal/plugin/notes/notes.js', async: true }
        ]
      });

    </script>

  </body>
</html>
